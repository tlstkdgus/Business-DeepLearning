<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ëŒ€ì¶œ ì‹¬ì‚¬ ì‹œìŠ¤í…œ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .card {
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .card-header {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            text-align: center;
            padding: 20px;
        }
        
        .form-control, .form-select {
            border-radius: 10px;
            border: 2px solid #e9ecef;
            padding: 12px;
            transition: all 0.3s ease;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #007bff, #0056b3);
            border: none;
            border-radius: 10px;
            padding: 12px 30px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,123,255,0.4);
        }
        
        .result-card {
            border-left: 5px solid #28a745;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
        }
        
        .approval-percentage {
            font-size: 3rem;
            font-weight: bold;
            color: #28a745;
            text-align: center;
            margin: 20px 0;
        }
        
        .dti-display {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            margin: 15px 0;
        }
        
        .dti-good { color: #28a745; }
        .dti-warning { color: #ffc107; }
        .dti-danger { color: #dc3545; }
        
        .product-card {
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            background: white;
            transition: all 0.3s ease;
        }
        
        .product-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .loading {
            text-align: center;
            padding: 50px;
        }
        
        .spinner-border {
            width: 3rem;
            height: 3rem;
        }
        
        .chat-interface {
            background: white;
            border-radius: 15px;
            height: 400px;
            overflow-y: auto;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 10px;
            max-width: 80%;
        }
        
        .user-message {
            background: #007bff;
            color: white;
            margin-left: auto;
            text-align: right;
        }
        
        .ai-message {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
        }
        
        .progress {
            height: 25px;
            border-radius: 10px;
        }
        
        .feature-icon {
            font-size: 1.5rem;
            color: #007bff;
            margin-right: 10px;
        }
        
        /* ë§ˆí¬ë‹¤ìš´ ìŠ¤íƒ€ì¼ë§ */
        .markdown-content {
            line-height: 1.6;
            color: #333;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .markdown-content h1 {
            color: #007bff;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .markdown-content h2 {
            color: #0056b3;
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 8px;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .markdown-content h3 {
            color: #495057;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .markdown-content p {
            margin-bottom: 15px;
            text-align: justify;
        }
        
        .markdown-content strong {
            color: #007bff;
            font-weight: 600;
        }
        
        .markdown-content ul, .markdown-content ol {
            margin-bottom: 15px;
            padding-left: 25px;
        }
        
        .markdown-content li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .markdown-content blockquote {
            border-left: 4px solid #007bff;
            background: #f8f9fa;
            margin: 15px 0;
            padding: 15px 20px;
            font-style: italic;
            border-radius: 5px;
        }
        
        .markdown-content code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #e83e8c;
            font-size: 0.9em;
        }
        
        .markdown-content .emoji {
            font-size: 1.2em;
            margin-right: 5px;
        }
        
        .markdown-content .status-good {
            color: #28a745;
            font-weight: 600;
        }
        
        .markdown-content .status-warning {
            color: #ffc107;
            font-weight: 600;
        }
        
        .markdown-content .status-danger {
            color: #dc3545;
            font-weight: 600;
        }
        
        .markdown-content .highlight-box {
            background: linear-gradient(135deg, #e3f2fd, #f8f9fa);
            border: 1px solid #007bff;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .markdown-content .warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .markdown-content .success {
            background: #d4edda;
            border: 1px solid #28a745;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .markdown-content .danger {
            background: #f8d7da;
            border: 1px solid #dc3545;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        /* AI ë©”ì‹œì§€ ì „ìš© ìŠ¤íƒ€ì¼ */
        .ai-message.markdown-content {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <div class="main-container">
        <!-- í—¤ë” -->
        <div class="card">
            <div class="card-header">
                <h1><i class="fas fa-university"></i> AI ëŒ€ì¶œ ì‹¬ì‚¬ ì‹œìŠ¤í…œ</h1>
                <p class="mb-0">ì¸ê³µì§€ëŠ¥ ê¸°ë°˜ ëŒ€ì¶œ ìŠ¹ì¸ ê°€ëŠ¥ì„± ë¶„ì„ ë° ìƒí’ˆ ì¶”ì²œ</p>
            </div>
        </div>

        <div class="row">
            <!-- ì¢Œì¸¡: ì‚¬ìš©ì ì •ë³´ ì…ë ¥ í¼ -->
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-user"></i> ê³ ê° ì •ë³´ ì…ë ¥</h3>
                    </div>
                    <div class="card-body">
                        <form id="loanForm">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="age" class="form-label">
                                        <i class="fas fa-calendar-alt feature-icon"></i>ë‚˜ì´
                                    </label>
                                    <input type="number" class="form-control" id="age" min="19" max="65" required placeholder="ë§Œ ë‚˜ì´ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="credit_score" class="form-label">
                                        <i class="fas fa-star feature-icon"></i>ì‹ ìš©ì ìˆ˜
                                    </label>
                                    <input type="number" class="form-control" id="credit_score" min="300" max="1000" required placeholder="ì‹ ìš©ì ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="annual_income" class="form-label">
                                    <i class="fas fa-won-sign feature-icon"></i>ì—°ì†Œë“ (ì›)
                                </label>
                                <input type="text" class="form-control" id="annual_income" required placeholder="ì—°ì†Œë“ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 50,000,000)" data-type="currency">
                            </div>
                            
                            <div class="mb-3">
                                <label for="desired_amount" class="form-label">
                                    <i class="fas fa-money-bill-wave feature-icon"></i>í¬ë§ ëŒ€ì¶œê¸ˆì•¡ (ì›)
                                </label>
                                <input type="text" class="form-control" id="desired_amount" required placeholder="í¬ë§ ëŒ€ì¶œê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 30,000,000)" data-type="currency">
                            </div>
                            
                            <div class="mb-3">
                                <label for="monthly_debt" class="form-label">
                                    <i class="fas fa-credit-card feature-icon"></i>ê¸°ì¡´ ì›” ë¶€ì±„ìƒí™˜ì•¡ (ì›)
                                </label>
                                <input type="text" class="form-control" id="monthly_debt" placeholder="ê¸°ì¡´ ëŒ€ì¶œ ì›” ìƒí™˜ê¸ˆ (ì—†ìœ¼ë©´ 0 ë˜ëŠ” ë¹„ì›Œë‘ì„¸ìš”)" data-type="currency">
                            </div>
                            
                            <div class="mb-3">
                                <label for="loan_purpose" class="form-label">
                                    <i class="fas fa-target feature-icon"></i>ëŒ€ì¶œ ëª©ì 
                                </label>
                                <select class="form-select" id="loan_purpose">
                                    <option value="ìƒí™œìê¸ˆ">ìƒí™œìê¸ˆ</option>
                                    <option value="ì£¼íƒêµ¬ì…">ì£¼íƒêµ¬ì…</option>
                                    <option value="ì „ì„¸ìê¸ˆ">ì „ì„¸ìê¸ˆ</option>
                                    <option value="ì‚¬ì—…ìê¸ˆ">ì‚¬ì—…ìê¸ˆ</option>
                                    <option value="í•™ìê¸ˆ">í•™ìê¸ˆ</option>
                                    <option value="ë¶€ì±„ì •ë¦¬">ë¶€ì±„ì •ë¦¬</option>
                                </select>
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-100 btn-lg">
                                <i class="fas fa-search"></i> ëŒ€ì¶œ ì‹¬ì‚¬ ë°›ê¸°
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- ìš°ì¸¡: ê²°ê³¼ í‘œì‹œ -->
            <div class="col-lg-6">
                <div id="results" style="display: none;">
                    <!-- ìŠ¹ì¸ ê°€ëŠ¥ì„± -->
                    <div class="card result-card">
                        <div class="card-header">
                            <h3><i class="fas fa-chart-line"></i> ëŒ€ì¶œ ì‹¬ì‚¬ ê²°ê³¼</h3>
                        </div>
                        <div class="card-body">
                            <div class="row text-center">
                                <div class="col-6">
                                    <h5>ìŠ¹ì¸ ê°€ëŠ¥ì„±</h5>
                                    <div id="approvalPercentage" class="approval-percentage">0%</div>
                                    <div class="progress">
                                        <div id="approvalProgress" class="progress-bar bg-success" role="progressbar" style="width: 0%"></div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <h5>DTI ë¹„ìœ¨</h5>
                                    <div id="dtiDisplay" class="dti-display">0%</div>
                                    <small class="text-muted">ì´ë¶€ì±„ì›ë¦¬ê¸ˆìƒí™˜ë¹„ìœ¨</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI ë¶„ì„ ê²°ê³¼ -->
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-robot"></i> AI ë¶„ì„ ê²°ê³¼</h3>
                        </div>
                        <div class="card-body">
                            <div id="aiExplanation" class="chat-interface">
                                <!-- AI ë¶„ì„ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                            </div>
                        </div>
                    </div>

                    <!-- ì¶”ì²œ ìƒí’ˆ -->
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-gift"></i> ì¶”ì²œ ëŒ€ì¶œ ìƒí’ˆ</h3>
                        </div>
                        <div class="card-body">
                            <div id="recommendedProducts">
                                <!-- ì¶”ì²œ ìƒí’ˆì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ë¡œë”© í™”ë©´ -->
                <div id="loading" style="display: none;">
                    <div class="card">
                        <div class="card-body loading">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <h4 class="mt-3">AIê°€ ëŒ€ì¶œ ì‹¬ì‚¬ë¥¼ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤...</h4>
                            <p class="text-muted">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
                        </div>
                    </div>
                </div>

                <!-- ì´ˆê¸° ì•ˆë‚´ -->
                <div id="welcome" class="card">
                    <div class="card-body text-center">
                        <i class="fas fa-hand-point-left" style="font-size: 3rem; color: #007bff; margin-bottom: 20px;"></i>
                        <h4>ì¢Œì¸¡ í¼ì„ ì‘ì„±í•´ì£¼ì„¸ìš”</h4>
                        <p class="text-muted">
                            ê°œì¸ì •ë³´ë¥¼ ì…ë ¥í•˜ì‹œë©´ AIê°€ ëŒ€ì¶œ ìŠ¹ì¸ ê°€ëŠ¥ì„±ì„ ë¶„ì„í•˜ê³ <br>
                            ë§ì¶¤í˜• ìƒí’ˆì„ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤.
                        </p>
                        <div class="mt-4">
                            <div class="row">
                                <div class="col-12 mb-2">
                                    <small class="text-success"><i class="fas fa-shield-alt"></i> ì•ˆì „í•œ ì•”í˜¸í™” ì²˜ë¦¬</small>
                                </div>
                                <div class="col-12 mb-2">
                                    <small class="text-info"><i class="fas fa-clock"></i> ì‹¤ì‹œê°„ ì‹¬ì‚¬</small>
                                </div>
                                <div class="col-12">
                                    <small class="text-warning"><i class="fas fa-robot"></i> AI ê¸°ë°˜ ë¶„ì„</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('loanForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // ë¡œë”© í™”ë©´ í‘œì‹œ
            document.getElementById('welcome').style.display = 'none';
            document.getElementById('results').style.display = 'none';
            document.getElementById('loading').style.display = 'block';
            
            // í¼ ë°ì´í„° ìˆ˜ì§‘ (ì½¤ë§ˆ ì œê±° í›„ ìˆ«ì ë³€í™˜)
            const formData = {
                age: parseInt(document.getElementById('age').value),
                annual_income: getNumericValue('annual_income'),
                credit_score: parseInt(document.getElementById('credit_score').value),
                desired_amount: getNumericValue('desired_amount'),
                monthly_debt: getNumericValue('monthly_debt'),
                loan_purpose: document.getElementById('loan_purpose').value
            };
            
            try {
                const response = await fetch('/api/loan-check', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    displayResults(result.data);
                } else {
                    alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + result.error);
                }
            } catch (error) {
                alert('ì„œë²„ í†µì‹  ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                console.error('Error:', error);
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        });
        
        function displayResults(data) {
            // ìŠ¹ì¸ ê°€ëŠ¥ì„± í‘œì‹œ
            const percentage = data.approval_percentage;
            document.getElementById('approvalPercentage').textContent = percentage + '%';
            document.getElementById('approvalProgress').style.width = percentage + '%';
            
            // DTI í‘œì‹œ
            const dti = data.dti;
            const dtiElement = document.getElementById('dtiDisplay');
            dtiElement.textContent = dti + '%';
            
            // DTI ìƒ‰ìƒ ì„¤ì •
            dtiElement.className = 'dti-display ';
            if (dti <= 30) {
                dtiElement.className += 'dti-good';
            } else if (dti <= 40) {
                dtiElement.className += 'dti-warning';
            } else {
                dtiElement.className += 'dti-danger';
            }
            
            // AI ë¶„ì„ ê²°ê³¼ í‘œì‹œ (ë§ˆí¬ë‹¤ìš´ ì ìš©)
            const aiExplanationElement = document.getElementById('aiExplanation');
            const markdownContent = processMarkdownContent(data.ai_explanation);
            aiExplanationElement.innerHTML = 
                '<div class="ai-message message markdown-content">' + 
                markdownContent + 
                '</div>';
            
            // ì¶”ì²œ ìƒí’ˆ í‘œì‹œ
            displayRecommendedProducts(data.recommended_products);
            
            // ê²°ê³¼ ì˜ì—­ í‘œì‹œ
            document.getElementById('results').style.display = 'block';
        }
        
        function displayRecommendedProducts(products) {
            const container = document.getElementById('recommendedProducts');
            
            console.log('ì¶”ì²œ ìƒí’ˆ ë°ì´í„°:', products); // ë””ë²„ê·¸ ë¡œê·¸
            
            if (!products || products.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        í˜„ì¬ ì¡°ê±´ì— ë§ëŠ” ì¶”ì²œ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤. 
                        <br><small>ì¡°ê±´ì„ ì¡°ì •í•˜ì‹œê±°ë‚˜ ìƒë‹´ì„ í†µí•´ ë” ìì„¸í•œ ì •ë³´ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.</small>
                    </div>
                `;
                return;
            }
            
            let html = '';
            products.forEach((product, index) => {
                const minRate = product.interest_rate_min || 0;
                const maxRate = product.interest_rate_max || 0;
                const maxAmount = product.max_amount || 0;
                const minAmount = product.min_amount || 0;
                const matchScore = product.match_score || 0;
                
                // ë§¤ì¹­ ì ìˆ˜ì— ë”°ë¥¸ ë°°ì§€ ìƒ‰ìƒ
                let badgeColor = 'bg-secondary';
                if (matchScore >= 80) badgeColor = 'bg-success';
                else if (matchScore >= 60) badgeColor = 'bg-primary';
                else if (matchScore >= 40) badgeColor = 'bg-warning';
                
                html += `
                    <div class="product-card">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div class="flex-grow-1">
                                <div class="d-flex align-items-center mb-2">
                                    <h5 class="text-primary mb-0 me-2">${product.name}</h5>
                                    <span class="badge ${badgeColor}">ë§¤ì¹­ë„ ${matchScore}%</span>
                                </div>
                                <p class="text-muted mb-2">${product.description || 'ìƒí’ˆ ì„¤ëª…'}</p>
                            </div>
                        </div>
                        
                        <div class="row mb-2">
                            <div class="col-md-6">
                                <small><strong><i class="fas fa-percentage text-primary"></i> ê¸ˆë¦¬:</strong> ${minRate}% ~ ${maxRate}%</small>
                            </div>
                            <div class="col-md-6">
                                <small><strong><i class="fas fa-won-sign text-success"></i> í•œë„:</strong> ${(minAmount/10000).toFixed(0)}ë§Œì› ~ ${(maxAmount/10000).toFixed(0)}ë§Œì›</small>
                            </div>
                        </div>
                        
                        <div class="mb-2">
                            <small><strong><i class="fas fa-star text-warning"></i> ì¶”ì²œ ì´ìœ :</strong> ${product.match_reason || 'ì¡°ê±´ ë¶€í•©'}</small>
                        </div>
                        
                        ${product.features ? `
                            <div class="mt-2">
                                ${product.features.map(feature => 
                                    `<span class="badge bg-light text-dark me-1 mb-1"><i class="fas fa-check text-success"></i> ${feature}</span>`
                                ).join('')}
                            </div>
                        ` : ''}
                        
                        ${product.all_reasons && product.all_reasons.length > 1 ? `
                            <div class="mt-2">
                                <small class="text-muted">
                                    <strong>ì¶”ê°€ í˜œíƒ:</strong> ${product.all_reasons.slice(1).join(', ')}
                                </small>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // ë§ˆí¬ë‹¤ìš´ ì½˜í…ì¸  ì²˜ë¦¬ í•¨ìˆ˜
        function processMarkdownContent(content) {
            if (typeof marked !== 'undefined') {
                // marked ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©
                marked.setOptions({
                    breaks: true,
                    gfm: true
                });
                return marked.parse(content);
            } else {
                // ê¸°ë³¸ ë§ˆí¬ë‹¤ìš´ ì²˜ë¦¬
                let html = content
                    // í—¤ë”© ì²˜ë¦¬
                    .replace(/^## (.*?)$/gm, '<h2>$1</h2>')
                    .replace(/^### (.*?)$/gm, '<h3>$1</h3>')
                    
                    // ê°•ì¡° ì²˜ë¦¬
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    
                    // ì´ëª¨ì§€ ìŠ¤íƒ€ì¼ë§
                    .replace(/âœ…/g, '<span class="emoji status-good">âœ…</span>')
                    .replace(/ğŸŸ¡/g, '<span class="emoji status-warning">ğŸŸ¡</span>')
                    .replace(/âš ï¸/g, '<span class="emoji status-warning">âš ï¸</span>')
                    .replace(/âŒ/g, '<span class="emoji status-danger">âŒ</span>')
                    .replace(/âœ¨/g, '<span class="emoji">âœ¨</span>')
                    .replace(/ğŸ¯/g, '<span class="emoji">ğŸ¯</span>')
                    .replace(/ï¿½/g, '<span class="emoji">ï¿½</span>')
                    .replace(/ï¿½/g, '<span class="emoji">ï¿½</span>')
                    .replace(/ğŸ“ˆ/g, '<span class="emoji">ğŸ“ˆ</span>')
                    
                    // ë¦¬ìŠ¤íŠ¸ ì²˜ë¦¬
                    .replace(/^- (.*?)$/gm, '<li>$1</li>')
                    .replace(/^\d+\. (.*?)$/gm, '<li>$1</li>')
                    
                    // ì¤„ë°”ê¿ˆ ì²˜ë¦¬
                    .replace(/\n\n/g, '</p><p>')
                    .replace(/\n/g, '<br>');
                
                // ì—°ì†ëœ li íƒœê·¸ë¥¼ ulë¡œ ê°ì‹¸ê¸°
                html = html.replace(/(<li>.*?<\/li>)(\s*<li>.*?<\/li>)*/gs, function(match) {
                    return '<ul>' + match + '</ul>';
                });
                
                // p íƒœê·¸ë¡œ ê°ì‹¸ê¸°
                if (!html.startsWith('<h') && !html.startsWith('<ul') && !html.startsWith('<ol')) {
                    html = '<p>' + html + '</p>';
                }
                
                return html;
            }
        }
        
        // ê°œì„ ëœ ìˆ«ì ì…ë ¥ í¬ë§·íŒ…
        function setupCurrencyInput(input) {
            // ìˆ«ìë§Œ í—ˆìš©í•˜ê³  ì‹¤ì‹œê°„ ì½¤ë§ˆ í¬ë§·íŒ…
            input.addEventListener('input', function(e) {
                let value = this.value.replace(/[^0-9]/g, ''); // ìˆ«ìë§Œ í—ˆìš©
                if (value) {
                    // ì²œë‹¨ìœ„ ì½¤ë§ˆ ì¶”ê°€
                    this.value = parseInt(value).toLocaleString('ko-KR');
                } else {
                    this.value = '';
                }
            });
            
            // ë¶™ì—¬ë„£ê¸° ì‹œì—ë„ ì²˜ë¦¬
            input.addEventListener('paste', function(e) {
                setTimeout(() => {
                    let value = this.value.replace(/[^0-9]/g, '');
                    if (value) {
                        this.value = parseInt(value).toLocaleString('ko-KR');
                    }
                }, 10);
            });
            
            // í¬ì»¤ìŠ¤ ì‹œ ì½¤ë§ˆ ì œê±°í•˜ì§€ ì•Šê³  ëìœ¼ë¡œ ì»¤ì„œ ì´ë™
            input.addEventListener('focus', function() {
                setTimeout(() => {
                    this.setSelectionRange(this.value.length, this.value.length);
                }, 10);
            });
        }
        
        // ìˆ«ì ê°’ ì¶”ì¶œ í•¨ìˆ˜
        function getNumericValue(elementId) {
            const element = document.getElementById(elementId);
            if (!element || !element.value) return 0;
            return parseInt(element.value.replace(/[^0-9]/g, '')) || 0;
        }
        
        // í†µí™” ì…ë ¥ í•„ë“œ ì„¤ì •
        document.addEventListener('DOMContentLoaded', function() {
            setupCurrencyInput(document.getElementById('annual_income'));
            setupCurrencyInput(document.getElementById('desired_amount'));
            setupCurrencyInput(document.getElementById('monthly_debt'));
        });
    </script>
</body>
</html>